<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Veri Ajansı – Analiz Raporu</title>
  <style>
    * { box-sizing:border-box; }
    body {
      margin:0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:#0f172a;
      color:#0f172a;
    }
    .shell {
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
    .topbar {
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 32px;
      background:rgba(15,23,42,0.98);
      color:#e5e7eb;
      position:sticky;
      top:0;
      z-index:20;
      border-bottom:1px solid rgba(148,163,184,0.4);
    }
    .brand {
      display:flex;
      align-items:center;
      gap:10px;
    }
    .brand-logo {
      width:32px;
      height:32px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 20%,#14b8a6,#0f766e 40%,#0f766e);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:800;
      font-size:16px;
      color:white;
    }
    .brand-text-main { font-size:14px; font-weight:600; }
    .brand-text-sub { font-size:11px; color:#9ca3af; }
    .top-links a {
      font-size:12px;
      color:#cbd5f5;
      text-decoration:none;
      margin-left:12px;
    }
    .top-links a:hover { color:white; }

    .page {
      flex:1;
      padding:24px 32px 32px;
      background:radial-gradient(circle at top,#1d283a,#020617 55%);
      overflow:auto;
    }
    .card {
      max-width:1100px;
      margin:0 auto;
      background:white;
      border-radius:22px;
      padding:20px 22px 24px;
      box-shadow:0 28px 80px rgba(15,23,42,0.75);
      border:1px solid rgba(148,163,184,0.5);
    }
    h1 { font-size:22px; margin:0 0 4px; }
    .meta {
      font-size:12px;
      color:#6b7280;
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:4px 12px;
      margin-bottom:14px;
    }
    .pill {
      display:inline-flex;
      align-items:center;
      padding:3px 9px;
      border-radius:999px;
      font-size:11px;
      background:#eff6ff;
      color:#0f766e;
    }
    .kpi-row {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
      margin-bottom:10px;
    }
    .kpi {
      flex:1 1 140px;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid #e5e7eb;
      background:linear-gradient(135deg,#f9fafb,#eff6ff);
    }
    .kpi-title {
      font-size:11px;
      text-transform:uppercase;
      color:#6b7280;
      letter-spacing:.05em;
      margin-bottom:2px;
    }
    .kpi-value {
      font-size:18px;
      font-weight:650;
      color:#0f172a;
    }
    h2 {
      font-size:16px;
      margin-top:14px;
      margin-bottom:6px;
      border-bottom:1px solid #e5e7eb;
      padding-bottom:3px;
    }
    table {
      border-collapse:collapse;
      width:100%;
      font-size:12px;
      margin-top:4px;
    }
    th, td {
      border:1px solid #e5e7eb;
      padding:4px 6px;
      text-align:left;
    }
    th {
      background:#f3f4f6;
    }
    .charts {
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:6px;
    }
    .chart-card {
      flex:1 1 230px;
      max-width:260px;
      border-radius:14px;
      border:1px solid #e5e7eb;
      background:#ffffff;
      box-shadow:0 10px 24px rgba(15,23,42,0.12);
      padding:6px 8px 8px;
    }
    .chart-title {
      font-size:11px;
      color:#4b5563;
      margin-bottom:3px;
    }
    .sample-wrap {
      max-height:260px;
      overflow:auto;
      border-radius:12px;
      border:1px solid #e5e7eb;
    }
    .domain-list li {
      font-size:13px;
      margin-bottom:2px;
    }
    .footer-note {
      font-size:10px;
      color:#9ca3af;
      margin-top:12px;
      text-align:right;
    }
    @media (max-width:900px) {
      .page { padding:16px; }
      .card { border-radius:18px; padding:18px 16px 20px; }
    }
      html[data-theme="light"] body {
      background:#f3f4f6;
      color:#0f172a;
    }
    html[data-theme="light"] .page {
      background:radial-gradient(circle at top,#e5e7eb,#ffffff 60%);
    }
    html[data-theme="light"] .card {
      box-shadow:0 18px 40px rgba(148,163,184,0.45);
    }
  </style>
</head>
<body>
<div class="shell">
  <header class="topbar">
    <div class="brand">
  <img src="/static/logo_veri_ajansi.png" alt="Veri Ajansı" style="width:32px;height:32px;object-fit:contain;">
  <div>
    <div class="brand-text-main">Veri Ajansı – Otomatik Analiz Raporu</div>
    <div class="brand-text-sub">İşletmenizin verisini dakikalar içinde okunur hale getirir.</div>
  </div>
</div>
    <div class="top-links">
      <a href="/upload">Yeni Veri Yükle</a>
      <a href="/dashboard">Son Dashboard</a>
      <a href="/admin/uploads?key=veriadmin">Yükleme Kayıtları</a>
      <a href="#" onclick="window.print();return false;">PDF / Yazdır</a>
      <button type="button" onclick="toggleTheme()" style="margin-left:8px;padding:4px 10px;border-radius:999px;border:1px solid #4b5563;background:#020617;color:#e5e7eb;font-size:11px;cursor:pointer;">Tema</button>
    </div>
  </header>

  <main class="page">
    <section class="card">
      <h1>Analiz Özeti</h1>
      <div class="meta">
        <div>
          Müşteri: <strong>{{ name }}</strong> – {{ company }}<br>
          İletişim: {{ email }} / {{ phone }}
        </div>
        <div style="text-align:right;">
          Dosya: <strong>{{ file_name }}</strong><br>
          Tür: <span class="pill">{{ data_type }}</span>
        </div>
      </div>

      <div class="kpi-row">
        <div class="kpi">
          <div class="kpi-title">Toplam Satır</div>
          <div class="kpi-value">{{ row_count }}</div>
        </div>
        <div class="kpi">
          <div class="kpi-title">Toplam Sütun</div>
          <div class="kpi-value">{{ col_count }}</div>
        </div>
        <div class="kpi">
          <div class="kpi-title">Sayısal Kolon</div>
          <div class="kpi-value">{{ numeric_cols|length }}</div>
        </div>
        <div class="kpi">
          <div class="kpi-title">Veri Kalite Puanı</div>
          <div class="kpi-value">{{ "%.1f"|format(quality_score) }}%</div>
        </div>
      </div>
      <p style="font-size:12px;color:#6b7280;">
        En çok eksik veri içeren kolon: <strong>{{ top_missing_col }}</strong> &nbsp; | &nbsp;
        En yüksek oynaklığa sahip kolon: <strong>{{ top_var_col }}</strong><br>
        Hücre sayısı: {{ total_cells }} &nbsp; | &nbsp; Toplam eksik hücre: {{ total_missing }}
      </p>

      <h2>1. Sayısal Kolon Özeti (İlk 5)</h2>
      {% if numeric_cols %}
      <table>
        <thead>
          <tr><th>Kolon</th><th>Min</th><th>Max</th><th>Ort.</th><th>Toplam</th></tr>
        </thead>
        <tbody>
        {% for col, stats in summary_stats.items() %}
          <tr>
            <td>{{ col }}</td>
            <td>{{ stats.min }}</td>
            <td>{{ stats.max }}</td>
            <td>{{ stats.mean }}</td>
            <td>{{ stats.sum }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>Sayısal kolon bulunamadı.</p>
      {% endif %}

      <h2>2. Eksik Veri Analizi</h2>
      <table>
        <thead><tr><th>Kolon</th><th>Eksik Değer Sayısı</th></tr></thead>
        <tbody>
        {% for col, cnt in na_counts.items() %}
          <tr><td>{{ col }}</td><td>{{ cnt }}</td></tr>
        {% endfor %}
        </tbody>
      </table>

      <h2>3. Görsel Analizler</h2>
      <div class="charts">
        {% if chart_paths %}
          {% for path in chart_paths %}
          <div class="chart-card">
            <div class="chart-title">
              {% if loop.index == 1 %}Zaman Serisi{% elif loop.index == 2 %}Histogram{% elif loop.index == 3 %}Ortalama Karşılaştırma{% elif loop.index == 4 %}Günlük Toplam{% elif loop.index == 5 %}Korelasyon Isı Haritası{% elif loop.index == 6 %}Eksik Veri Haritası{% else %}Grafik {{ loop.index }}{% endif %}
            </div>
            <img src="{{ path }}" alt="Grafik" style="width:100%;border-radius:8px;">
          </div>
          {% endfor %}
        {% else %}
          <p>Grafik üretilemedi.</p>
        {% endif %}
      </div>

      <h2>4. Kategorik Analiz (İlk 3 Kolon)</h2>
      {% if top_categories %}
        {% for col, cats in top_categories.items() %}
          <p style="font-size:13px;"><strong>{{ col }}</strong> için en sık görülen değerler:</p>
          <ul>
          {% for val, cnt in cats.items() %}
            <li style="font-size:12px;">{{ val }} → {{ cnt }}</li>
          {% endfor %}
          </ul>
        {% endfor %}
      {% else %}
        <p>Kategorik kolon analizi bulunamadı.</p>
      {% endif %}

      <h2>5. Örnek Kayıtlar (İlk 20 Satır)</h2>
      <div class="sample-wrap">
        {{ sample_html | safe }}
      </div>

      <h2>6. Alanınıza Özel İlk Yorumlar</h2>
      <ul class="domain-list">
        {% for insight in domain_insights %}
        <li>{{ insight }}</li>
        {% endfor %}
      </ul>

      <div class="footer-note">
        Bu rapor Veri Ajansı Veri Analiz Asistanı v10 tarafından otomatik oluşturulmuştur.
      </div>
    </section>
  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  function toggleTheme() {
    const html = document.documentElement;
    const current = html.dataset.theme || 'dark';
    const next = current === 'dark' ? 'light' : 'dark';
    html.dataset.theme = next;
    try { localStorage.setItem('va-theme', next); } catch(e){}
  }
  (function initTheme(){
    try {
      const saved = localStorage.getItem('va-theme') || 'dark';
      document.documentElement.dataset.theme = saved;
    } catch(e){
      document.documentElement.dataset.theme = 'dark';
    }
  })();

  // interaktif çizgi grafik (ilk sayısal kolon)
  document.addEventListener('DOMContentLoaded', function() {
    const el = document.getElementById('interactiveChart');
    if (!el) return;
    const dataEl = document.getElementById('chartDataJson');
    if (!dataEl) return;
    const payload = JSON.parse(dataEl.textContent || '{}');
    if (!payload || !payload.values || payload.values.length === 0) return;

    const ctx = el.getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: payload.labels,
        datasets: [{
          label: payload.label,
          data: payload.values,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: true },
        },
        scales: {
          x: { ticks: { display: false } }
        }
      }
    });
  });
</script>
</body>
</html>
</html>
